# Mini Cloud - Персональное облачное хранилище

Полнофункциональное веб-приложение для хранения файлов с современным интерфейсом и продвинутой системой безопасности.

## Технологии

**Backend:**
- FastAPI (Python)
- MongoDB (база данных)
- JWT аутентификация
- Bcrypt (хеширование паролей)

**Frontend:**
- React 19
- Tailwind CSS
- Shadcn UI компоненты
- Axios для API запросов

## Основные возможности

### Файловый менеджер
- ✅ Загрузка файлов с drag & drop поддержкой
- ✅ Создание вложенных папок неограниченной глубины
- ✅ Скачивание файлов
- ✅ Перемещение файлов и папок между директориями
- ✅ Удаление файлов и папок с подтверждением
- ✅ Breadcrumb навигация (хлебные крошки)
- ✅ Отображение размеров файлов и папок
- ✅ Изолированное хранилище для каждого пользователя

### Система пользователей
- ✅ Регистрация/авторизация с хешированием паролей (Bcrypt)
- ✅ Валидация паролей (8+ символов, заглавные, строчные, спецсимволы)
- ✅ JWT токены для сессий
- ✅ Личный кабинет со статистикой
- ✅ Смена пароля с проверкой текущего
- ✅ Rate limiting: 5 попыток входа / 15 минут

### Панель администрирования
- ✅ Система ролей: супер-админ и назначенные админы
- ✅ Управление пользователями (просмотр, изменение роли)
- ✅ Смена паролей пользователей администраторами
- ✅ Удаление пользователей
- ✅ Ограничения: назначенные админы не могут изменять других админов
- ✅ Статистика всех пользователей
- ✅ Защита супер-админа от изменений

### Интерфейс
- ✅ Современный минималистичный дизайн
- ✅ Облачная цветовая схема (светло-голубые тона)
- ✅ Темная и светлая темы с переключателем
- ✅ Плавные анимации и переходы
- ✅ Адаптивный дизайн для всех устройств
- ✅ Модальные окна и диалоги подтверждения

### Безопасность
- ✅ JWT аутентификация с Bearer токенами
- ✅ Хеширование паролей (Bcrypt)
- ✅ Rate limiting для защиты от брутфорса
- ✅ Валидация загружаемых файлов
- ✅ Блокировка опасных расширений (.php, .exe, .js, .html, и др.)
- ✅ Проверка MIME типов файлов
- ✅ CORS настройка
- ✅ Логирование событий безопасности

## Быстрый старт

### Супер-администратор
При первом запуске автоматически создается супер-админ:
- **Username:** admin
- **Password:** admin
- **Email:** admin@minicloud.com

⚠️ **Важно:** Измените пароль после первого входа!

### Структура проекта
```
/app/
├── backend/              # FastAPI backend
│   ├── server.py        # Основной файл приложения
│   ├── .env            # Переменные окружения
│   └── requirements.txt
├── frontend/            # React frontend
│   ├── src/
│   │   ├── pages/      # Страницы приложения
│   │   ├── components/ # UI компоненты
│   │   └── App.js
│   └── package.json
└── uploads/            # Хранилище файлов пользователей
```

### Переменные окружения

**Backend (.env):**
```
MONGO_URL="mongodb://localhost:27017"
DB_NAME="minicloud_database"
JWT_SECRET_KEY="your-secret-key"
CORS_ORIGINS="*"
```

**Frontend (.env):**
```
REACT_APP_BACKEND_URL=<ваш-backend-url>
```

## Конфигурация

### Максимальный размер файла
По умолчанию: **100 MB**

Для изменения отредактируйте в `backend/server.py`:
```python
MAX_FILE_SIZE = 100 * 1024 * 1024  # 100MB
```

Для поддержки файлов до 100GB в production:
1. Увеличьте `MAX_FILE_SIZE`
2. Настройте nginx/веб-сервер для больших загрузок
3. Убедитесь в достаточном дисковом пространстве

### Блокируемые расширения файлов
Для безопасности заблокированы следующие типы:
- `.php`, `.jsp`, `.asp`, `.aspx` - серверные скрипты
- `.exe`, `.bat`, `.cmd`, `.sh` - исполняемые файлы
- `.js`, `.html`, `.htm` - потенциально опасные веб-файлы

Для изменения списка отредактируйте в `server.py`:
```python
BLOCKED_EXTENSIONS = ['.php', '.exe', ...]
```

## API Endpoints

### Аутентификация
- `POST /api/auth/register` - Регистрация нового пользователя
- `POST /api/auth/login` - Вход в систему
- `POST /api/auth/change-password` - Смена пароля
- `GET /api/auth/me` - Получить текущего пользователя

### Файлы
- `POST /api/files/upload` - Загрузка файла
- `GET /api/files/download/{file_id}` - Скачивание файла
- `DELETE /api/files/delete/{file_id}` - Удаление файла
- `POST /api/files/move` - Перемещение файла
- `GET /api/files/list` - Список файлов

### Папки
- `POST /api/folders/create` - Создание папки
- `DELETE /api/folders/delete/{folder_id}` - Удаление папки
- `POST /api/folders/move` - Перемещение папки
- `GET /api/folders/tree` - Дерево папок
- `GET /api/folders/breadcrumb/{folder_id}` - Breadcrumb навигация

### Статистика
- `GET /api/user/stats` - Статистика пользователя

### Администрирование
- `GET /api/admin/users` - Список всех пользователей
- `POST /api/admin/change-role` - Изменение роли пользователя
- `POST /api/admin/change-password` - Смена пароля пользователя
- `DELETE /api/admin/delete-user/{user_id}` - Удаление пользователя

## База данных

### Коллекции MongoDB

**users:**
- `id` - уникальный идентификатор
- `username` - имя пользователя
- `email` - электронная почта
- `password_hash` - хеш пароля
- `role` - роль (user/admin)
- `is_super_admin` - флаг супер-админа
- `storage_used` - использованное хранилище (байты)
- `created_at` - дата создания

**files:**
- `id` - уникальный идентификатор файла
- `name` - имя файла
- `size` - размер в байтах
- `mime_type` - MIME тип
- `owner_id` - ID владельца
- `folder_id` - ID родительской папки
- `created_at` - дата загрузки

**folders:**
- `id` - уникальный идентификатор
- `name` - имя папки
- `parent_id` - ID родительской папки
- `owner_id` - ID владельца
- `created_at` - дата создания

**login_attempts:**
- `username` - имя пользователя
- `timestamp` - время попытки

**security_logs:**
- `event_type` - тип события
- `user_id` - ID пользователя
- `details` - детали события
- `timestamp` - время события

## Безопасность

### Rate Limiting
- Максимум 5 попыток входа за 15 минут
- Блокировка при превышении лимита

### Валидация паролей
Требования к паролю:
- Минимум 8 символов
- Хотя бы одна заглавная буква
- Хотя бы одна строчная буква
- Хотя бы один спецсимвол

### Логирование событий
Все важные события безопасности логируются:
- Регистрация пользователя
- Вход в систему
- Изменение пароля
- Загрузка/скачивание/удаление файлов
- Действия администратора

## Разработка

### Запуск backend
```bash
cd backend
pip install -r requirements.txt
uvicorn server:app --reload --host 0.0.0.0 --port 8001
```

### Запуск frontend
```bash
cd frontend
yarn install
yarn start
```

### Перезапуск сервисов
```bash
# Backend
sudo supervisorctl restart backend

# Frontend
sudo supervisorctl restart frontend
```

## Устранение неполадок

### Backend не запускается
Проверьте логи:
```bash
tail -f /var/log/supervisor/backend.err.log
```

### Frontend не подключается к backend
1. Проверьте `REACT_APP_BACKEND_URL` в frontend/.env
2. Убедитесь, что backend работает
3. Проверьте CORS настройки

### Файлы не загружаются
1. Проверьте права на директорию `/app/uploads`
2. Проверьте размер файла (не более 100MB по умолчанию)
3. Проверьте расширение файла (не в списке блокировки)

## Производительность

- Поддержка больших файлов через streaming
- Эффективная работа с MongoDB indexes
- Оптимизированные запросы к БД
- Кэширование статических файлов

---

**Версия:** 1.0.0  
**Дата:** Октябрь 2025  
**Создано:** Emergent AI Agent
